<!doctype html>
<html lang="zh-Hans">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>文言文智能翻译</title>
  <script src="https://unpkg.com/pinyin-pro/dist/pinyin-pro.umd.js"></script>
  <style>
    :root {
      --bg: #0b0f14;
      --card: #121821;
      --muted: #233044;
      --text: #e7eef7;
      --sub: #9db2cf;
      --accent: #4da3ff;
      --border: #1c2431;
      --hl: #1d2a3c;
      --chip: #22334b;
      --yellow: #ffd166;
      --green: #00b894;
    }

    * {
      box-sizing: border-box
    }

    html,
    body {
      height: 100%;
      overflow-x: hidden
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans SC", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
      background: linear-gradient(180deg, #0b0f14, #0e141d);
      color: var(--text)
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 28px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-height: 100vh
    }

    header {
      flex-shrink: 0;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 18px 20px;
      display: flex;
      gap: 14px;
      align-items: center;
      justify-content: space-between
    }

    header h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.02em
    }

    .btn {
      background: var(--hl);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s
    }

    .btn:hover {
      border-color: #2d3b52;
      background: #233044
    }

    .btn.primary {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
      font-weight: 600
    }

    .btn.primary:hover {
      background: #3b8ee6
    }

    .btn.secondary {
      background: transparent
    }

    .btn.toggle {
      background: var(--hl);
      border: 1px solid var(--border)
    }

    .btn.toggle.active {
      outline: 2px solid var(--accent)
    }

    .main-area {
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 1fr 0.6fr;
      gap: 20px;
      align-items: start
    }

    .panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 16px;
      min-height: 400px
    }

    .panel-hd {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px
    }

    .panel-title {
      font-weight: 600;
      color: var(--sub);
      font-size: 14px
    }

    textarea {
      flex: 1;
      width: 100%;
      background: #0d131c;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      color: var(--text);
      font-size: 16px;
      line-height: 1.8;
      resize: none;
      font-family: inherit
    }

    textarea:focus {
      outline: 2px solid var(--accent);
      border-color: transparent
    }

    .output-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #0d131c;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      position: relative
    }

    .tab-nav {
      display: flex;
      background: var(--hl);
      border-bottom: 1px solid var(--border)
    }

    .tab-btn {
      padding: 10px 16px;
      font-size: 13px;
      color: var(--sub);
      cursor: pointer;
      border-right: 1px solid var(--border)
    }

    .tab-btn.active {
      background: var(--accent);
      color: #fff;
      font-weight: 600
    }

    .tab-btn:hover:not(.active) {
      color: var(--text)
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: none
    }

    .tab-content.active {
      display: block
    }

    .sent-block {
      margin-bottom: 24px;
      border-bottom: 1px dashed var(--border);
      padding-bottom: 16px
    }

    .sent-block:last-child {
      border-bottom: none
    }

    .sent-orig {
      font-size: 18px;
      margin-bottom: 8px;
      line-height: 2
    }

    .sent-trans {
      font-size: 15px;
      color: var(--sub);
      line-height: 1.6
    }

    .char {
      display: inline-block;
      padding: 0 4px;
      margin: 0 1px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.1s
    }

    .char:hover {
      background: rgba(77, 163, 255, .15)
    }

    .char.active {
      background: rgba(77, 163, 255, .25);
      outline: 1px solid rgba(77, 163, 255, .4)
    }

    .char.has-phrase {
      text-decoration: underline;
      text-decoration-style: dotted;
      text-decoration-color: var(--sub);
      text-underline-offset: 4px
    }

    .punct {
      opacity: 0.6;
      cursor: default
    }

    .log-panel {
      margin-top: 20px;
      background: #0d131c;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      font-family: monospace;
      font-size: 12px;
      color: var(--sub);
      max-height: 150px;
      overflow-y: auto;
      display: none
    }

    .log-entry {
      margin-bottom: 4px;
      border-bottom: 1px solid #1c2431;
      padding-bottom: 2px
    }

    .log-entry.error {
      color: #ff6b6b
    }

    .log-entry.info {
      color: #4da3ff
    }

    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000
    }

    .settings-modal.active {
      display: flex
    }

    .modal-content {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5)
    }

    .modal-hd {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px
    }

    .modal-hd h2 {
      margin: 0;
      font-size: 18px
    }

    .form-group {
      margin-bottom: 16px
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--sub)
    }

    .form-group input,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      background: #0d131c;
      color: var(--text);
      border: 1px solid var(--border)
    }

    .form-group textarea {
      min-height: 80px;
      resize: vertical
    }

    .loading-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--sub);
      font-size: 13px
    }

    .spinner {
      width: 14px;
      height: 14px;
      border: 2px solid var(--sub);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite
    }

    @keyframes spin {
      to {
        transform: rotate(360deg)
      }
    }

    .sidebar {
      position: sticky;
      top: 28px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: calc(100vh - 56px);
      overflow-y: auto
    }

    .info-box {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px
    }

    .info-box h3 {
      margin: 0 0 10px 0;
      font-size: 15px;
      color: var(--sub)
    }

    .info-row {
      display: grid;
      grid-template-columns: 80px 1fr;
      gap: 8px;
      margin-bottom: 8px;
      align-items: start
    }

    .info-label {
      color: var(--sub);
      font-size: 13px
    }

    .info-value {
      font-size: 14px;
      word-break: break-all
    }

    .info-value.large {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent)
    }

    .divider {
      height: 1px;
      background: var(--border);
      margin: 10px 0
    }

    .small {
      font-size: 12px;
      color: var(--sub)
    }

    @media (max-width: 1200px) {
      .container {
        padding: 16px
      }

      .main-area {
        grid-template-columns: 1fr;
        height: auto
      }

      .panel {
        min-height: 50vh
      }

      .sidebar {
        position: relative;
        max-height: none;
        margin-top: 20px
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <div style="display:flex;align-items:center;gap:12px">
        <h1>文言文智能翻译</h1>
        <span class="loading-indicator" id="status" style="display:none">
          <div class="spinner"></div> <span id="statusText">正在分析...</span>
        </span>
      </div>
      <div style="display:flex;gap:10px">
        <button class="btn toggle" id="togglePhrase">手动选词</button>
        <button class="btn secondary" id="btnSettings">⚙️ 设置 API</button>
        <button class="btn primary" id="btnTranslate">开始翻译</button>
      </div>
    </header>

    <div class="main-area">
      <section class="panel">
        <div class="panel-hd">
          <span class="panel-title">文言文原文</span>
          <button class="btn secondary" style="padding:4px 8px;font-size:12px" id="btnClear">清空</button>
        </div>
        <textarea id="inputSrc" placeholder="在此输入文言文..."></textarea>
      </section>

      <section class="panel">
        <div class="panel-hd">
          <span class="panel-title">翻译结果</span>
          <button class="btn secondary" style="padding:4px 8px;font-size:12px" id="btnCopy">复制全文</button>
        </div>
        <div class="output-container">
          <div class="tab-nav">
            <div class="tab-btn active" data-tab="detailed">对照模式 (逐字)</div>
            <div class="tab-btn" data-tab="text">全文模式</div>
          </div>
          <div id="tabDetailed" class="tab-content active">
            <div style="color:var(--sub);font-style:italic;text-align:center;margin-top:20px">翻译后在此查看逐句对照与逐字释义</div>
          </div>
          <div id="tabText" class="tab-content" style="white-space:pre-wrap;line-height:1.8"></div>
        </div>
        <div class="log-panel" id="logPanel"></div>
      </section>

      <aside class="sidebar">
        <div class="info-box" id="phraseBox" style="display:none">
          <h3>词组释义</h3>
          <div class="info-row">
            <div class="info-label">词组</div>
            <div class="info-value" id="phText">—</div>
          </div>
          <div class="info-row">
            <div class="info-label">拼音</div>
            <div class="info-value" id="phPinyin">—</div>
          </div>
          <div class="info-row">
            <div class="info-label">释义</div>
            <div class="info-value" id="phGloss">—</div>
          </div>
        </div>

        <div class="info-box">
          <h3>单字释义</h3>
          <div class="info-row">
            <div class="info-label">选中字</div>
            <div class="info-value large" id="charDisplay">—</div>
          </div>
          <div class="info-row">
            <div class="info-label">拼音</div>
            <div class="info-value" id="pinyinDisplay">—</div>
          </div>
          <div class="info-row">
            <div class="info-label">词性</div>
            <div class="info-value" id="posDisplay">—</div>
          </div>
          <div class="info-row">
            <div class="info-label">释义</div>
            <div class="info-value" id="glossDisplay">—</div>
          </div>
          <div class="divider"></div>
          <div class="small">点击文本中的字符查看详细释义。开启"手动选词"后可先后点击起止字选择词组。</div>
        </div>
      </aside>
    </div>
  </div>

  <div class="settings-modal" id="settingsModal">
    <div class="modal-content">
      <div class="modal-hd">
        <h2>API 配置</h2>
        <button class="btn secondary" id="btnCloseSettings">✕</button>
      </div>
      <div class="form-group">
        <label>API 地址 (Base URL)</label>
        <input id="apiUrl" placeholder="https://api.openai.com/v1/chat/completions" />
      </div>
      <div class="form-group">
        <label>API Key</label>
        <input id="apiKey" type="password" placeholder="sk-..." />
      </div>
      <div class="form-group">
        <label>模型名称 (Model)</label>
        <input id="apiModel" placeholder="gpt-4o, deepseek-chat, etc." />
      </div>
      <div class="form-group">
        <button class="btn secondary" id="btnPresetDeepseek" style="width:100%">一键填入 DeepSeek 配置</button>
      </div>
      <div style="text-align:right">
        <button class="btn primary" id="btnSaveSettings">保存配置</button>
      </div>
    </div>
  </div>

  <script src="translate.js"></script>
</body>

</html>